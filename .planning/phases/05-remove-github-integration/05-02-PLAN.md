---
phase: 05-remove-github-integration
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - midl-agent/src/search/workflow-orchestrator.ts
  - midl-agent/src/search/workflow-orchestrator.test.ts
  - midl-agent/src/search/bug-report-generator.ts
autonomous: true

must_haves:
  truths:
    - "WorkflowOrchestrator no longer imports or uses any GitHub-dependent modules"
    - "WorkflowOrchestrator.handleProblemReport() generates and returns a diagnostic report"
    - "No GitHub API calls are made anywhere in active code"
    - "BugReportGenerator still formats report drafts without GitHub dependencies"
  artifacts:
    - path: "midl-agent/src/search/workflow-orchestrator.ts"
      provides: "Simplified diagnostic-only orchestrator"
      exports: ["WorkflowOrchestrator", "WorkflowResult"]
    - path: "midl-agent/src/search/workflow-orchestrator.test.ts"
      provides: "Tests for simplified orchestrator"
  key_links:
    - from: "midl-agent/src/search/workflow-orchestrator.ts"
      to: "midl-agent/src/search/diagnostic-report-generator.ts"
      via: "import and usage in handleProblemReport"
      pattern: "DiagnosticReportGenerator"
---

<objective>
Rewrite WorkflowOrchestrator to remove all GitHub dependencies, keeping only diagnostic report generation and bug report formatting.

Purpose: The orchestrator becomes a simple pipeline: user describes problem -> generate diagnostic report -> present to user. No search, no duplicate detection, no issue creation.
Output: Simplified WorkflowOrchestrator with updated tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-remove-github-integration/05-01-SUMMARY.md
@midl-agent/src/search/workflow-orchestrator.ts
@midl-agent/src/search/diagnostic-report-generator.ts
@midl-agent/src/search/bug-report-generator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite WorkflowOrchestrator to diagnostic-only</name>
  <files>
    midl-agent/src/search/workflow-orchestrator.ts
    midl-agent/src/search/bug-report-generator.ts
  </files>
  <action>
Rewrite `workflow-orchestrator.ts` to remove ALL GitHub-dependent imports and logic. The new orchestrator should:

1. **Remove imports** for: DuplicateDetector, SolutionExtractor, ApplicabilityScorer, IssueCreator, FixImplementer, GitHubClient, AttachmentFetcher, and all types from search-types.ts.

2. **Keep imports** for: DiagnosticReportGenerator, DiagnosticContext, BugReportGenerator, BugReportDraft, SearchConfig/loadSearchConfig.

3. **Simplify WorkflowResult** interface:
   - Remove: searchPerformed, duplicatesFound, solutions, hasSolutions
   - Keep: reportDraft, formattedResponse, diagnosticReport
   - The result now always contains a diagnostic report

4. **Simplify constructor**: Only instantiate DiagnosticReportGenerator, BugReportGenerator, and load config. Remove all GitHub-related fields.

5. **Rewrite handleProblemReport()**:
   - Accept `userDescription: string` and optional `diagnosticContext: Partial<DiagnosticContext>`
   - Generate a BugReportDraft using BugReportGenerator
   - If diagnosticContext provided, generate diagnostic report using DiagnosticReportGenerator (fill in defaults for missing fields)
   - Build formattedResponse showing the diagnostic report to the user
   - Return simplified WorkflowResult

6. **Remove methods**: submitReport(), implementSolution(), formatSolutionsResponse(), buildUserContext().

7. **Keep methods**: generateReportDraft() (simplified), formatReportDraftResponse() (updated to not mention GitHub search).

8. **Update formatReportDraftResponse()**: Remove text about "I searched GitHub" - instead say "Here's a diagnostic report based on your issue description:" and show the report content. Include instructions for the user to share the report with the MIDL team (e.g., on Discord or GitHub).

Also check `bug-report-generator.ts` for any GitHub-specific imports or references. If `formatAsGitHubLink()` method exists, keep it but it's informational - no changes needed since it generates a URL the user can use manually.
  </action>
  <verify>
Run `npx tsc --noEmit` from midl-agent/ to confirm no TypeScript errors.
Grep for "github-client" and "duplicate-detector" in workflow-orchestrator.ts to confirm no GitHub imports remain.
  </verify>
  <done>WorkflowOrchestrator has zero GitHub dependencies. It generates diagnostic reports and bug report drafts only.</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite WorkflowOrchestrator tests</name>
  <files>midl-agent/src/search/workflow-orchestrator.test.ts</files>
  <action>
Rewrite `workflow-orchestrator.test.ts` to test the simplified orchestrator:

1. **Remove all mocks** for: DuplicateDetector, SolutionExtractor, ApplicabilityScorer, IssueCreator, FixImplementer, GitHubClient, AttachmentFetcher.

2. **Test cases to include:**
   - `handleProblemReport()` returns a reportDraft with title and body extracted from description
   - `handleProblemReport()` with diagnosticContext generates a diagnostic report with all 5 sections
   - `handleProblemReport()` without diagnosticContext still returns a reportDraft
   - `generateReportDraft()` returns a BugReportDraft
   - `formattedResponse` does NOT contain "GitHub" or "searched GitHub"
   - `formattedResponse` contains instructions to share with MIDL team

3. **Use real instances** (no mocks needed since DiagnosticReportGenerator and BugReportGenerator are pure/stateless).

4. **Run tests**: `npx vitest run src/search/workflow-orchestrator.test.ts`
  </action>
  <verify>
Run `npx vitest run src/search/workflow-orchestrator.test.ts` and confirm all tests pass.
  </verify>
  <done>All workflow-orchestrator tests pass, covering diagnostic report generation without any GitHub mocking.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- `npx vitest run src/search/workflow-orchestrator.test.ts` passes
- `grep -r "github-client\|duplicate-detector\|issue-creator\|GitHubClient" midl-agent/src/search/workflow-orchestrator.ts` returns nothing
</verification>

<success_criteria>
WorkflowOrchestrator is a simple diagnostic-report-only pipeline. No GitHub dependencies remain in active (non-legacy) code. Tests pass.
</success_criteria>

<output>
After completion, create `.planning/phases/05-remove-github-integration/05-02-SUMMARY.md`
</output>
