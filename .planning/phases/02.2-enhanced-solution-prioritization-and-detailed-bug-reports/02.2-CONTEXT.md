# Phase 2.2: Enhanced Solution Prioritization and Detailed Bug Reports - Context

**Created:** 2026-02-01
**Source:** User requirements from discussion

---

## Phase Boundary

This phase improves solution presentation and bug report quality:
1. **Solution source prioritization** - Distinguish official MIDL team responses from community suggestions, always prioritize official fixes
2. **Comprehensive diagnostic reports** - Generate detailed .md reports with full context (environment, steps, fixes tried, suggestions) and attach them to GitHub issues

New capabilities (filtering, analytics, etc.) belong in other phases.

---

## User Decisions (LOCKED)

These decisions are FINAL. The planner must implement exactly as specified.

### 1. Solution Source Identification

**Decision:** Use GitHub organization membership to identify official MIDL team responses.

**Implementation:**
- Check if comment author belongs to `@midl-xyz` organization (most reliable signal via GitHub API)
- Organization membership = official response
- Non-members = community suggestions
- No need to maintain manual username lists or check collaborator status separately

**Mixed thread handling:**
- Prioritize official response only
- If thread has both official and community responses, show official team response
- Community suggestions become fallback (shown only if no official response exists)
- Don't show community suggestions alongside official responses

**Time priority:**
- Claude's discretion on whether to use first, latest, or all official responses
- Planner determines relevance based on comment content and issue status

**No official response scenario:**
- Show community solutions with caution label
- Format: "No official response yet. Community suggestions:" followed by solutions
- Include clear disclaimer that these are unverified
- Don't skip issues entirely - users benefit from community knowledge

### 2. Solution Presentation Hierarchy

**Decision:** Use badge labels to visually distinguish official vs community solutions.

**Badge system:**
- Official team responses: "✓ OFFICIAL FIX" badge
- Community suggestions: "Community suggestion (not officially verified by MIDL team)" label
- Neutral disclaimer tone (not strong caution, not overly promotional)

**Priority order:**
- Official responses ALWAYS first, regardless of applicability score
- Community suggestions second (if shown at all)
- Within each category (official/community), sort by applicability score descending

**Source explanation:**
- Badge is enough for inline display
- Details available "on hover" or when user asks
- Full attribution (e.g., "@username, MIDL team member") available but not shown by default
- Keep presentation clean - don't clutter with excessive metadata

**Why this matters:** Users need to know authority level at a glance. Official team responses carry weight for architectural decisions, security issues, and compatibility guarantees.

### 3. Diagnostic Report Structure

**Decision:** Generate comprehensive .md diagnostic reports with 5 structured sections.

**Required sections:**

1. **Problem Description**
   - What the user experienced
   - Error messages verbatim
   - Expected vs actual behavior

2. **Environment Details** (COMPREHENSIVE)
   - All MIDL SDK packages + exact versions (e.g., @midl/react@2.1.0, @midl/executor-react@3.0.1)
   - Node.js version
   - Operating system (Windows 11, macOS Sonoma, etc.)
   - Browser/wallet versions if applicable (Chrome 120, Xverse 1.10.1)
   - Network (testnet, mainnet, regtest, signet)
   - Full package.json dependencies (relevant packages)
   - **Rationale:** Team needs complete picture to reproduce issues, version mismatches are common root causes

3. **Steps Taken by Agent**
   - What searches were performed (search terms, results count)
   - Duplicate detection results (issues found, similarity scores)
   - What was analyzed during troubleshooting

4. **Fixes Attempted** (if any)
   - Solutions the agent tried
   - Outcomes of each attempt
   - Why they didn't work

5. **Suggestions for Team** (STRUCTURED + OPEN-ENDED)
   - Use fixed headings:
     - **Possible Causes:** Agent's analysis of potential root causes
     - **Recommended Fixes:** Specific suggestions for team
     - **Test Cases:** Reproduction steps or test scenarios
   - Within each heading, agent provides natural language analysis
   - Agent has discretion on depth based on issue complexity

**NOT included:**
- Full conversation transcript (too verbose, not actionable)
- Related issues already shown in "Steps Taken" section

**Format:** GitHub-flavored markdown, clear headings, code blocks for errors/commands

### 4. Report Generation Workflow

**Decision:** Generate diagnostic report AFTER user approves bug report draft, with preview offer.

**Workflow:**
1. Agent drafts bug report (title + summary)
2. User reviews and approves draft
3. **Agent notifies:** "Creating GitHub issue with comprehensive diagnostic report attached..."
4. Agent generates full diagnostic .md report
5. Agent shows summary: "Generated 2.4KB diagnostic report (5 sections). View full report?"
6. User can choose to review full report or proceed with submission
7. Agent uploads diagnostic report as file attachment
8. Issue body contains quick summary: "Issue: [brief problem], Tried: [attempts], Outcome: [result]. See attached diagnostic report for details."

**Attachment method:**
- Primary: Upload .md file as GitHub attachment (requires upload permission)
- Issue body: Quick summary only (3-4 sentences)
- Fallback: If upload fails → embed full report in issue body instead

**Why this workflow:**
- User approves intent before generation (no surprise content)
- Separates user-facing summary from technical deep-dive
- Team gets detailed diagnostics without cluttering issue description
- Graceful degradation if upload fails

---

## Claude's Discretion

These are areas where Claude has freedom to make implementation choices.

### Applicability Scoring for Mixed Sources
Claude determines how to weight official vs community solutions when calculating applicability:
- Whether official status adds bonus points to score
- How to handle official low-relevance vs community high-relevance scenarios
- Edge case: official "won't fix" vs community workaround

### Time-Based Prioritization
Claude determines relevance of comment timestamps:
- Whether to use first official response, latest official response, or all
- How to handle contradictory official responses across time
- Whether to mark solutions as "outdated" based on issue close date

### Diagnostic Report Formatting Details
Claude chooses:
- Exact markdown styling (heading levels, code block languages)
- How to truncate long error messages
- How to format package.json dependencies (full list vs relevant subset)
- Indentation and whitespace for readability

### Error Handling and Degradation
Claude determines graceful degradation approach for:
- GitHub API failures during organization membership check
- File upload failures (how to format fallback embed)
- Missing environment data (how to request from user vs infer vs skip)

---

## What Exists Already

### From Prior Phases

**Phase 2 (Search & Duplicate Detection):**
- IssueSearcher, SimilarityScorer, DuplicateDetector
- Search results with similarity scores

**Phase 2.1 (Attachment Content Extraction):**
- AttachmentFetcher for downloading issue attachments
- Enhanced duplicate detection accuracy

**Phase 3 (Solution Extraction & User Flow):**
- SolutionExtractor parsing issue comments
- ApplicabilityScorer scoring solutions against user context
- BugReportGenerator drafting reports from conversation
- IssueCreator submitting issues to GitHub
- WorkflowOrchestrator coordinating the flow

**What's missing for Phase 2.2:**
- Organization membership check for comment authors
- Official vs community solution classification
- Badge rendering in formatted responses
- Diagnostic report generator (new class)
- File upload to GitHub (new GitHubClient method)
- Workflow changes to generate and attach diagnostic report

---

## File Structure Reference

After Phase 2.2:

```
midl-agent/
├── src/
│   ├── search/
│   │   ├── solution-extractor.ts (UPDATE: add isOfficial flag)
│   │   ├── diagnostic-report-generator.ts (NEW: generate .md reports)
│   │   ├── github-client.ts (UPDATE: add uploadFile method, checkOrgMembership)
│   │   ├── workflow-orchestrator.ts (UPDATE: generate + attach reports)
│   │   └── ...
│   └── types/
│       └── search-types.ts (UPDATE: add isOfficial to Solution type)
```

---

## Deferred Ideas

None. Discussion stayed within phase scope.

---

## Success Metrics

Phase 2.2 is successful if:

1. ✓ Agent correctly identifies official MIDL team responses via organization membership
2. ✓ Official solutions ALWAYS appear before community suggestions
3. ✓ Users see "✓ OFFICIAL FIX" badge for team responses
4. ✓ Community suggestions show neutral disclaimer when no official response exists
5. ✓ Diagnostic reports include all 5 sections with comprehensive environment details
6. ✓ Reports upload as .md attachments to GitHub issues
7. ✓ Issue body contains quick summary + link to attached report
8. ✓ Graceful fallback to embedded report if upload fails
9. ✓ User can review diagnostic report before submission

---

*Phase: 02.2-enhanced-solution-prioritization-and-detailed-bug-reports*
*Context gathered: 2026-02-01*
