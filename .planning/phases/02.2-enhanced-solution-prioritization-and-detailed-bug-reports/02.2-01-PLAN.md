---
phase: 02.2-enhanced-solution-prioritization-and-detailed-bug-reports
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - midl-agent/src/types/search-types.ts
  - midl-agent/src/search/github-client.ts
  - midl-agent/src/search/solution-extractor.ts
autonomous: true

must_haves:
  truths:
    - "Solutions from MIDL team members are tagged with isOfficial: true"
    - "GitHubClient can check if a user belongs to midl-xyz organization"
    - "SolutionExtractor marks solutions from org members as official"
    - "Org membership check degrades gracefully on API failure (defaults to non-official)"
  artifacts:
    - path: "midl-agent/src/types/search-types.ts"
      provides: "isOfficial field on Solution type"
      contains: "isOfficial"
    - path: "midl-agent/src/search/github-client.ts"
      provides: "checkOrgMembership method"
      contains: "checkOrgMembership"
    - path: "midl-agent/src/search/solution-extractor.ts"
      provides: "Official solution classification"
      contains: "isOfficial"
  key_links:
    - from: "midl-agent/src/search/solution-extractor.ts"
      to: "midl-agent/src/search/github-client.ts"
      via: "checkOrgMembership call"
      pattern: "checkOrgMembership"
---

<objective>
Add organization membership detection to GitHubClient and official solution classification to SolutionExtractor.

Purpose: Enable the agent to distinguish MIDL team responses from community suggestions by checking GitHub org membership of comment authors.
Output: Updated types with isOfficial flag, GitHubClient.checkOrgMembership method, SolutionExtractor that accepts a GitHubClient and marks solutions from org members.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@midl-agent/src/types/search-types.ts
@midl-agent/src/search/github-client.ts
@midl-agent/src/search/solution-extractor.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add isOfficial to Solution type and checkOrgMembership to GitHubClient</name>
  <files>midl-agent/src/types/search-types.ts, midl-agent/src/search/github-client.ts</files>
  <action>
1. In `search-types.ts`, add `isOfficial: boolean` field to the `Solution` interface. This indicates whether the solution came from a MIDL team organization member. Place it after the `confidence` field.

2. In `github-client.ts`, add a `checkOrgMembership` method:
   ```typescript
   async checkOrgMembership(username: string, org: string = "midl-xyz"): Promise<boolean>
   ```
   - Use `this.octokit.rest.orgs.checkMembershipForUser({ org, username })`
   - Return `true` if status is 204 (member), `false` otherwise
   - Catch ALL errors and return `false` (graceful degradation per CONTEXT.md)
   - Add an in-memory Map cache (`private orgMembershipCache: Map<string, boolean>`) to avoid repeated API calls for the same username within a session
   - Check cache before making API call
  </action>
  <verify>TypeScript compiles without errors: `cd midl-agent && npx tsc --noEmit`</verify>
  <done>Solution type has isOfficial boolean field. GitHubClient has checkOrgMembership that returns boolean with caching and graceful degradation.</done>
</task>

<task type="auto">
  <name>Task 2: Update SolutionExtractor to classify official solutions</name>
  <files>midl-agent/src/search/solution-extractor.ts</files>
  <action>
1. Update `SolutionExtractor` constructor to accept an optional `GitHubClient` dependency:
   ```typescript
   constructor(private githubClient?: GitHubClient)
   ```

2. Change `extract` method signature to be async:
   ```typescript
   async extract(issue: GitHubIssueResult, comments: IssueComment[]): Promise<Solution[]>
   ```

3. Inside `extract`, after building each solution object, determine `isOfficial`:
   - If `this.githubClient` is provided, call `await this.githubClient.checkOrgMembership(comment.author)`
   - If no githubClient provided, default `isOfficial: false`
   - Wrap the checkOrgMembership call in try/catch, default to `false` on error

4. Set `isOfficial` on each Solution object before pushing to array.

5. Update all existing places that construct `Solution` objects to include `isOfficial: false` as default (there's only the one place in `extract`).

6. Update existing tests in `solution-extractor.test.ts` to handle the async change and add `isOfficial: false` to expected outputs. Add one test case where a mock GitHubClient returns `true` for org membership and verify `isOfficial: true` on the resulting solution.
  </action>
  <verify>Run `cd midl-agent && npx vitest run solution-extractor` - all tests pass. Run `npx tsc --noEmit` - no type errors.</verify>
  <done>SolutionExtractor is async, accepts optional GitHubClient, and sets isOfficial based on org membership check with graceful fallback.</done>
</task>

</tasks>

<verification>
1. `cd midl-agent && npx tsc --noEmit` passes
2. `cd midl-agent && npx vitest run solution-extractor` passes
3. Solution type includes `isOfficial: boolean`
4. GitHubClient has `checkOrgMembership` method with cache
</verification>

<success_criteria>
- Solution interface has isOfficial field
- GitHubClient.checkOrgMembership works with caching and graceful degradation
- SolutionExtractor marks solutions from org members as official
- All existing tests updated and passing
</success_criteria>

<output>
After completion, create `.planning/phases/02.2-enhanced-solution-prioritization-and-detailed-bug-reports/02.2-01-SUMMARY.md`
</output>
