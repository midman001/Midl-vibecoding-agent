---
phase: 06-discord-integration
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - midl-agent/src/discord/commands/index.ts
  - midl-agent/src/discord/commands/help.ts
  - midl-agent/src/discord/commands/status.ts
  - midl-agent/src/discord/commands/links.ts
  - midl-agent/src/discord/commands/networks.ts
  - midl-agent/src/discord/command-handler.ts
autonomous: true

must_haves:
  truths:
    - "Bot responds to /help with usage guide"
    - "Bot responds to /status with bot health info"
    - "Bot responds to /links with MIDL dev resources"
    - "Bot responds to /networks with chain info and RPC endpoints"
    - "All responses are ephemeral (only visible to command user)"
    - "Responses use rich Discord embeds with color and organization"
  artifacts:
    - path: "midl-agent/src/discord/commands/help.ts"
      provides: "/help slash command"
      exports: ["helpCommand"]
    - path: "midl-agent/src/discord/commands/networks.ts"
      provides: "/networks slash command"
      exports: ["networksCommand"]
    - path: "midl-agent/src/discord/command-handler.ts"
      provides: "Central command registration and routing"
      exports: ["CommandHandler"]
  key_links:
    - from: "midl-agent/src/discord/command-handler.ts"
      to: "discord.js REST API"
      via: "slash command registration"
      pattern: "applicationGuildCommands"
---

<objective>
Create utility slash commands (/help, /status, /links, /networks) with rich embed responses and a CommandHandler for registration/routing.

Purpose: Bot provides immediate value with helpful MIDL development resources accessible via slash commands.
Output: Four working slash commands with ephemeral embed responses, centralized command handling.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-discord-integration/06-01-SUMMARY.md
@midl-agent/src/discord/discord-client.ts
@midl-agent/src/discord/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create slash command definitions and CommandHandler</name>
  <files>midl-agent/src/discord/commands/help.ts, midl-agent/src/discord/commands/status.ts, midl-agent/src/discord/commands/links.ts, midl-agent/src/discord/commands/networks.ts, midl-agent/src/discord/commands/index.ts, midl-agent/src/discord/command-handler.ts</files>
  <action>
    Each command file exports a `SlashCommand` interface: `{ data: SlashCommandBuilder, execute: (interaction: ChatInputCommandInteraction) => Promise<void> }`.

    1. **commands/help.ts** - `/help`:
       - Embed with bot description, list of all available commands with descriptions
       - Color: blue (#5865F2 - Discord blurple)
       - Footer: "MIDL Agent v1.0"

    2. **commands/status.ts** - `/status`:
       - Shows: bot uptime, ping/latency, connection status, guild name
       - Color: green (#57F287) if healthy
       - Include bot version from package.json

    3. **commands/links.ts** - `/links`:
       - MIDL documentation: https://js.midl.xyz/docs
       - GitHub repo: https://github.com/midl-xyz/midl-js
       - NPM packages: links to @midl/core, @midl/react, @midl/contracts, @midl/executor-react
       - MIDL website: https://midl.xyz
       - Color: blurple
       - Use embed fields for organized sections

    4. **commands/networks.ts** - `/networks`:
       - Define network data as const object (mainnet, testnet, devnet)
       - For each network show: name, chain ID, RPC endpoint, block explorer URL, status indicator
       - Use MIDL network info: mainnet (Bitcoin mainnet), testnet (Bitcoin testnet), devnet (local dev)
       - RPC endpoints: use placeholder format like `https://rpc.midl.xyz/mainnet` (user can update)
       - Block explorers: mempool.space links for mainnet/testnet
       - Color: blurple
       - Use embed fields, one per network

    5. **commands/index.ts** - barrel export all commands as array

    6. **command-handler.ts** - `CommandHandler` class:
       - Constructor takes `DiscordClient` instance
       - `registerCommands()`: uses discord.js REST API to register slash commands with guild (not global - faster for single server)
       - `handleInteraction(interaction)`: routes to correct command execute function
       - All responses use `interaction.reply({ ephemeral: true, embeds: [...] })` for privacy
       - Error handler: catch command execution errors, reply with ephemeral error embed
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>Four slash commands defined with rich embeds, CommandHandler registers and routes them, all responses ephemeral</done>
</task>

<task type="auto">
  <name>Task 2: Add command handler tests</name>
  <files>midl-agent/src/discord/command-handler.test.ts</files>
  <action>
    Test CommandHandler and command definitions:
    - Mock discord.js interaction with reply spy
    - Test cases:
      1. handleInteraction routes /help to help command
      2. handleInteraction routes /networks to networks command
      3. All command replies include ephemeral: true
      4. Unknown command name returns error embed
      5. Command execution error caught and replied with error message
      6. help command embed contains all command names
      7. links command embed contains documentation URL
      8. networks command embed has fields for each network
    - Use vitest mocking for discord.js types
  </action>
  <verify>`npx vitest run src/discord/command-handler.test.ts` passes</verify>
  <done>CommandHandler tests pass, verifying routing, ephemeral responses, error handling, embed content</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npx vitest run src/discord/command-handler.test.ts` passes
- Each command produces embed with correct color and content
</verification>

<success_criteria>
Four utility slash commands produce rich ephemeral embeds. CommandHandler registers and routes all commands. Tests verify routing and response content.
</success_criteria>

<output>
After completion, create `.planning/phases/06-discord-integration/06-03-SUMMARY.md`
</output>
